<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>Яхтвик «Весна на Канарах 2017» от компании Fleet5</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#fff">
    <meta name="format-detection" content="telephone=no">
    <script>
      (function(w, d, s, l, i)
      {
        w[l] = w[l] || [];
        w[l].push(
        {
          'gtm.start': new Date().getTime(),
          event: 'gtm.js'
        });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-MXNKFC4');

    </script>
    <!-- Скрипт для отслеживания событий GTM связаных с Youtube-->
    <script>
      var gtmYTPlayers = [];
      for (var e = document.getElementsByTagName("iframe"), x = e.length; x--;)
        if (/youtube.com\/embed/.test(e[x].src))
          if (e[x].src.indexOf('enablejsapi=') === -1)
            e[x].src += (e[x].src.indexOf('?') === -1 ? '?' : '&') + 'enablejsapi=1';

      function onYouTubeIframeAPIReady()
      {
        for (var e = document.getElementsByTagName("iframe"), x = e.length; x--;)
        {
          if (/youtube.com\/embed/.test(e[x].src))
          {
            gtmYTPlayers.push(new YT.Player(e[x],
            {
              events:
              {
                onStateChange: onPlayerStateChange,
                onError: onPlayerError
              }
            }));
            YT.gtmLastAction = "p";
          }
        }
      }
      /**
       * Listen for play/pause. Other states such as rewind and end could also be added
       * Also report % played every second
       * @param e - event
       **/
      function onPlayerStateChange(e)
      {
        e["data"] == YT.PlayerState.PLAYING && setTimeout(onPlayerPercent, 1000, e["target"]);
        var video_data = e.target["getVideoData"](),
          label = video_data.video_id + ':' + video_data.title;
        if (e["data"] == YT.PlayerState.PLAYING && YT.gtmLastAction == "p")
        {
          dataLayer.push(
          {
            event: 'youtube',
            eventCategory: 'youtube',
            eventAction: 'play',
            eventLabel: label
          });
          YT.gtmLastAction = "";
        }
        if (e["data"] == YT.PlayerState.PAUSED)
        {
          dataLayer.push(
          {
            event: 'youtube',
            eventCategory: 'youtube',
            eventAction: 'pause',
            eventLabel: label
          });
          YT.gtmLastAction = "p";
        }
      }
      /**
       * Catch all to report errors through the GTM data layer. once the error is exposed to GTM, it can be tracked in UA as an event!
       * Refer to https://developers.google.com/youtube/js_api_reference#Events onError
       * @param: e (event)
       **/
      function onPlayerError(e)
      {
        dataLayer.push(
        {
          event: 'error',
          eventCategory: 'youtube',
          eventAction: 'play',
          eventLabel: 'youtube: ' + e
        })
      }
      /**
       * Report the % played if it matches 0%, 25%, 50%, 75%, 90% or completed
       * @param: e (event)
       **/
      function onPlayerPercent(e)
      {
        if (e["getPlayerState"]() == YT.PlayerState.PLAYING)
        {
          //var t = e["getDuration"]() - e["getCurrentTime"]() <= 1.5 ? 1 : (Math.floor(e["getCurrentTime"]() / e["getDuration"]() * 4) / 4).toFixed(2);
          // Set the played duration to every tenth because we'll need to also capture 90% played.
          var t = e["getDuration"]() - e["getCurrentTime"]() <= 1.5 ? 1 : (Math.floor(e["getCurrentTime"]() / e["getDuration"]() * 10) / 10).toFixed(2);
          if (parseFloat(t) < 0.25)
          {
            t = 0.00;
          }
          else if (parseFloat(t) < 0.5)
          {
            t = 0.25;
          }
          else if (parseFloat(t) < 0.75)
          {
            t = 0.50;
          }
          else if (parseFloat(t) < 0.9)
          {
            t = 0.75;
          }
          else if (parseFloat(t) < 1)
          {
            t = 0.90;
          }
          // duration t needs to be fixed to 2 decimal places
          t = t.toFixed(2);
          if (!e["lastP"] || t > e["lastP"])
          {
            var video_data = e["getVideoData"](),
              label = video_data.video_id + ':' + video_data.title;
            e["lastP"] = t;
            dataLayer.push(
            {
              event: "youtube",
              eventCategory: 'youtube',
              eventAction: t * 100 + "%",
              eventLabel: label
            })
          }
          e["lastP"] != 1 && setTimeout(onPlayerPercent, 1000, e);
        }
      }
      /**
       * Add unload event listener
       **/
      window.addEventListener('beforeunload', function(e)
      {
        for (var i = 0; i < gtmYTPlayers.length; i++)
        {
          if (gtmYTPlayers[i].getPlayerState() === 1)
          { // playing
            var video_data = gtmYTPlayers[i]['getVideoData'](),
              label = video_data.video_id + ':' + video_data.title;
            dataLayer.push(
            {
              event: 'youtube',
              eventCategory: 'youtube',
              eventAction: 'exit',
              eventLabel: label
            });
          }
        }
      })
      // load the Youtube JS api and get going
      var j = document.createElement("script"),
        f = document.getElementsByTagName("script")[0];
      j.src = "//www.youtube.com/iframe_api";
      j.async = true;
      f.parentNode.insertBefore(j, f);

    </script>
    <meta name="description" content="Тут живе Тапольський!">
    <meta name="keywords" content="Тапольський, DJ, квартира">
    <!--Twitter Card data-->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@publisher_handle">
    <meta name="twitter:title" content="Яхтвик «Весна на Канарах 2017» от компании Fleet5">
    <meta name="twitter:description" content="Тут живе Тапольський!">
    <meta name="twitter:creator" content="@author_handle">
    <meta name="twitter:image" content="./img/mainprofile.jpg">
    <!--Open Graph data-->
    <meta property="og:title" content="Яхтвик «Весна на Канарах 2017» от компании Fleet5">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://nakvartiru.in.ua/">
    <meta property="og:image" content="./img/mainprofile.jpg">
    <meta property="og:description" content="Тут живе Тапольський!">
    <meta property="og:site_name" content="">
    <meta property="fb:admins" content="Facebook numeric ID">
    <!--favicons-->
    <link rel="apple-touch-icon-precomposed" href="./img/favicon-152.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="./img/favicon-144.png">
    <link rel="icon" href="./img/favicon-32.png" sizes="32x32">
    <link rel="shortcut icon" sizes="196x196" href="./img/favicon-196.png">
  </head>

  <body><noscript></noscript>
    <div class="main">
      <h1>Тут живе Тапольський!</h1>
    </div>
    <!--LOAD SCRIPTS-->
    <link rel="stylesheet" media="all" href="css/app.css">
    <script type="text/javascript" src="js/app.js"></script>
  </body>

</html>
